'''
pdr: Pedestrian Dead Reckoning
Usage:

python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 0 -tsid_idx 5 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 0 -tsid_idx 5 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xh
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 0 -tsid_idx 5 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 0 -tsid_idx 5 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw

python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 1 -tsid_idx 0 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 1 -tsid_idx 0 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xh
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 1 -tsid_idx 0 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 1 -tsid_idx 0 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yh

python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 2 -tsid_idx 13 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 2 -tsid_idx 13 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xh
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 2 -tsid_idx 13 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 2 -tsid_idx 13 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yh

python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 3 -tsid_idx 8 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 3 -tsid_idx 8 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xh
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 3 -tsid_idx 8 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 3 -tsid_idx 8 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yh

python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 4 -tsid_idx 4 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 4 -tsid_idx 4 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh xh
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 4 -tsid_idx 4 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yw
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 4 -tsid_idx 4 -lw 1 -iv_vt 2D -pa 0.2 -pss 1 -pxywh yh


python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 0 -tsid_idx 5 -lw 1 -iv_vt 3D -pa 0.2 -pss 1
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 1 -tsid_idx 0 -lw 1 -iv_vt 3D -pa 0.2 -pss 1
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 2 -tsid_idx 13 -lw 1 -iv_vt 3D -pa 0.2 -pss 1
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 3 -tsid_idx 8 -lw 1 -iv_vt 3D -pa 0.2 -pss 1
python3 vis_rel_xywh.py -n -rm investigate -nan linear_interp -tr_md_id Xformer_IFcC2C -sc 4 -tsid_idx 4 -lw 1 -iv_vt 3D -pa 0.2 -pss 1
'''
import argparse
import random
import numpy as np
import torch
import torch.nn as nn
from sklearn.metrics import f1_score
from scipy import stats
from embeddings import load_embeddings
from utils import Config, preprocess_config, BBX5_to_dBBX5, \
    BBX5_helper, labels_to_boxes
import train
from models import Xformer_IFcC2C
from embeddings import generate_embeddings
import matplotlib.pyplot as plt
import seaborn as sns

def proc_rel_xywh(C: Config):
    if C.running_mode == 'investigate':
        update_running_mode = True
        load_pretrained_embeds = False
        trainer, train_data_loader, val_data_loader, _, \
            train_seq_in_correspondence, val_seq_in_correspondence, _, \
            criterion, optimizer, C = preprocess_config(C, 'investigate', update_running_mode, load_pretrained_embeds)

        print('Change train to test mode.')
        print('pdr_baseline.py - proc_pdr_baseline - elif C.running_mode == test: len(train_seq_in_correspondence): ', len(train_seq_in_correspondence))
        # print('pdr_baseline.py - proc_pdr_baseline - elif C.running_mode == test: len(val_seq_in_correspondence): ', len(val_seq_in_correspondence))
        '''
        e.g.
        pdr_baseline.py - proc_pdr_baseline - elif C.running_mode == test: len(train_seq_in_correspondence):  3
        '''
        print('\n pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[0]): ', np.shape(train_seq_in_correspondence[0]))
        print('\n pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[1]): ', np.shape(train_seq_in_correspondence[1]))
        print('\n pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[2]): ', np.shape(train_seq_in_correspondence[2]))
        '''
        e.g.
         pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[0]):  (45900, 1, 1, 5)
         pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[1]):  (45900, 1, 1, 2)
         pdr_baseline.py - proc_pdr_baseline - np.shape(train_seq_in_correspondence[2]):  (45900, 1, 1, 19)
        '''
        slicing_step = 10 # 50 # edit
        x = np.squeeze(np.squeeze(train_seq_in_correspondence[0][:, :, :, 0]))[0:-1:slicing_step]
        y = np.squeeze(np.squeeze(train_seq_in_correspondence[0][:, :, :, 1]))[0:-1:slicing_step]
        w = np.squeeze(np.squeeze(train_seq_in_correspondence[0][:, :, :, 3]))[0:-1:slicing_step]
        h = np.squeeze(np.squeeze(train_seq_in_correspondence[0][:, :, :, 4]))[0:-1:slicing_step]
        print('\n len(x): ', len(x))
        x_feet_center = x
        y_feet_center = y + h / 2


        #
        # fig = plt.figure(figsize=(width, height), dpi=120)
        # plt.subplots_adjust(left=left, bottom=bottom, right=right, top=top, wspace=wspace, hspace=hspace)

        sns.set_style("whitegrid")

        if C.investigate_vis_type == '3D':
            ax = fig.add_subplot(projection='3d')
            ax.scatter(x_feet_center, y_feet_center, w, marker='o')
            ax.scatter(x_feet_center, y_feet_center, h, marker='^')

            ax.set_xlabel('X')
            ax.set_ylabel('Y')
            ax.set_zlabel('Z - o: width; ^: height')
        elif C.investigate_vis_type == '2D':
            # Edit >>>
            height = 2.3
            width = height * 1.623
            # fig = plt.figure(figsize=(width, height), dpi=120)
            # fig = plt.figure()
            left = 0.17 # 0.2 # 0.12 # 0.25 # 0.125  # the left side of the subplots of the figure
            right = 0.97 # 0.95 # 0.9   # the right side of the subplots of the figure
            bottom = 0.22 # 0.17 # 0.15 # 0.17 # 0.1802 # 0.1  # the bottom of the subplots of the figure
            top = 0.92 # 0.94 # 0.93 # 0.9     # the top of the subplots of the figure
            wspace = 0.2  # the amount of width reserved for space between subplots,
                          # expressed as a fraction of the average axis width
            hspace = 0.2  # the amount of height reserved for space between subplots,
                          # expressed as a fraction of the average axis height
            markersize = 2.5
            # Edit <<<

            plt.figure(figsize=(width, height), dpi=120)
            plt.subplots_adjust(left=left, bottom=bottom, right=right, top=top, wspace=wspace, hspace=hspace)

            '''
            Default colors:
            ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'])
            '''
            if C.plot_xywh == 'xw':
                plt.scatter(x_feet_center, w, alpha=C.plot_alpha, s=markersize, c='#1f77b4')
                plt.xlabel('Subject Feet Center Position in X Axis (Pixel)'); plt.ylabel('Subject Bbox Width (Pixel)')
            elif C.plot_xywh == 'xh':
                plt.scatter(x_feet_center, h, alpha=C.plot_alpha, s=markersize, c='#ff7f0e')
                plt.xlabel('Subject Feet Center Position in X Axis (Pixel)'); plt.ylabel('Subject Bbox Height (Pixel)')
            elif C.plot_xywh == 'yw':
                plt.scatter(y_feet_center, w, alpha=C.plot_alpha, s=markersize, c='#2ca02c')
                plt.xlabel('Subject Feet Center Position in Y Axis (Pixel)'); plt.ylabel('Subject Bbox Width (Pixel)')
            elif C.plot_xywh == 'yh':
                plt.scatter(y_feet_center, h, alpha=C.plot_alpha, s=markersize, c='#d62728')
                plt.xlabel('Subject Feet Center Position in X Axis (Pixel)'); plt.ylabel('Subject Bbox Height (Pixel)')
            plt.savefig('scene_{}_train_investigate_vis_type_{}_pa_{}_pss_{}_{}.pdf'.format(\
                C.scene_id, C.investigate_vis_type, C.plot_alpha, C.plot_slicing_steps, C.plot_xywh), dpi=300)

            # ax[1].scatter(x_feet_center, h, c='tab:orange', alpha=0.5)
            # ax[1].set_title('x vs h')
            # ax[1].set(xlabel='x', ylabel='h')
            #
            # ax[2].scatter(y_feet_center, w, c='tab:green', alpha=0.5)
            # ax[2].set_title('y vs w')
            # ax[2].set(xlabel='y', ylabel='w')
            #
            # ax[3].scatter(y_feet_center, h, c='tab:red', alpha=0.5)
            # ax[3].set_title('y vs h')
            # ax[3].set(xlabel='y', ylabel='h')


            # plt.savefig('scene_{}_train_investigate_vis_type_{}.jpg'.format(C.scene_id, C.investigate_vis_type), dpi=300)
        plt.show()


    def func_loss(model, batch):
        return None

    def func_forward(model, batch):
        return None

    def func_evaluate(labels, labels_PRED):
        return None

if __name__ == "__main__":
    C = Config()
    # print('\n\n C.__dict__: ', C.__dict__)
    # print('\n\n C: ', C)

    # Label here refers to decoded modality
    proc_rel_xywh(C)
